"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[7162],{8088:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"ros2/exercises/exercise1","title":"Exercise 2.1: Simple ROS 2 Publisher and Subscriber with Custom Message","description":"This exercise guides you through creating a basic ROS 2 publisher and subscriber using Python, incorporating a custom message type. This will solidify your understanding of ROS 2 package creation, message definition, and the fundamental publisher-subscriber communication pattern.","source":"@site/docs/ros2/exercises/exercise1.md","sourceDirName":"ros2/exercises","slug":"/ros2/exercises/exercise1","permalink":"/humanoid-robotics/ur/docs/ros2/exercises/exercise1","draft":false,"unlisted":false,"editUrl":"https://github.com/mishababar12/humanoid-robotics/tree/main/my-website/docs/ros2/exercises/exercise1.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 for Robot Control","permalink":"/humanoid-robotics/ur/docs/category/ros-2-for-robot-control"},"next":{"title":"ROS 2 for Robot Control","permalink":"/humanoid-robotics/ur/docs/ros2/"}}');var i=n(4848),t=n(8453);const o={},a="Exercise 2.1: Simple ROS 2 Publisher and Subscriber with Custom Message",c={},d=[{value:"Objectives",id:"objectives",level:2},{value:"Instructions",id:"instructions",level:2},{value:"Step 1: Create a ROS 2 Python Package",id:"step-1-create-a-ros-2-python-package",level:3},{value:"Step 2: Define a Custom Message Type",id:"step-2-define-a-custom-message-type",level:3},{value:"Step 3: Update <code>package.xml</code>",id:"step-3-update-packagexml",level:3},{value:"Step 4: Update <code>setup.py</code>",id:"step-4-update-setuppy",level:3},{value:"Step 5: Implement the Publisher Node",id:"step-5-implement-the-publisher-node",level:3},{value:"Step 6: Implement the Subscriber Node",id:"step-6-implement-the-subscriber-node",level:3},{value:"Step 7: Build Your Package",id:"step-7-build-your-package",level:3},{value:"Step 8: Run the Nodes",id:"step-8-run-the-nodes",level:3}];function l(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"exercise-21-simple-ros-2-publisher-and-subscriber-with-custom-message",children:"Exercise 2.1: Simple ROS 2 Publisher and Subscriber with Custom Message"})}),"\n",(0,i.jsx)(s.p,{children:"This exercise guides you through creating a basic ROS 2 publisher and subscriber using Python, incorporating a custom message type. This will solidify your understanding of ROS 2 package creation, message definition, and the fundamental publisher-subscriber communication pattern."}),"\n",(0,i.jsx)(s.h2,{id:"objectives",children:"Objectives"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Create a new ROS 2 Python package."}),"\n",(0,i.jsx)(s.li,{children:"Define a custom ROS 2 message type."}),"\n",(0,i.jsx)(s.li,{children:"Implement a publisher node that sends instances of your custom message."}),"\n",(0,i.jsx)(s.li,{children:"Implement a subscriber node that receives and processes these custom messages."}),"\n",(0,i.jsxs)(s.li,{children:["Correctly configure ",(0,i.jsx)(s.code,{children:"package.xml"})," and ",(0,i.jsx)(s.code,{children:"setup.py"})," for a Python package using custom messages."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"instructions",children:"Instructions"}),"\n",(0,i.jsx)(s.h3,{id:"step-1-create-a-ros-2-python-package",children:"Step 1: Create a ROS 2 Python Package"}),"\n",(0,i.jsxs)(s.p,{children:["Navigate to your ROS 2 workspace ",(0,i.jsx)(s.code,{children:"src"})," directory (e.g., ",(0,i.jsx)(s.code,{children:"~/ros2_ws/src"}),") and create a new package named ",(0,i.jsx)(s.code,{children:"custom_message_py"}),"."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python custom_message_py --dependencies rclpy std_msgs\n"})}),"\n",(0,i.jsx)(s.h3,{id:"step-2-define-a-custom-message-type",children:"Step 2: Define a Custom Message Type"}),"\n",(0,i.jsx)(s.p,{children:"Inside your new package, create a directory for messages and define your custom message."}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["Create a ",(0,i.jsx)(s.code,{children:"msg"})," directory inside ",(0,i.jsx)(s.code,{children:"custom_message_py"}),":","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"mkdir custom_message_py/msg\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Create a file named ",(0,i.jsx)(s.code,{children:"MyCustomMsg.msg"})," inside ",(0,i.jsx)(s.code,{children:"custom_message_py/msg"})," with the following content:","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"# custom_message_py/msg/MyCustomMsg.msg\nstring header_info\nint32 id\nfloat32 temperature\nbool is_valid\n"})}),"\n","This message will contain a string for general info, an integer ID, a float for temperature, and a boolean flag."]}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"step-3-update-packagexml",children:["Step 3: Update ",(0,i.jsx)(s.code,{children:"package.xml"})]}),"\n",(0,i.jsxs)(s.p,{children:["You need to tell ROS 2 that your package defines custom messages and depends on ",(0,i.jsx)(s.code,{children:"rosidl_default_generators"})," and ",(0,i.jsx)(s.code,{children:"rosidl_default_runtime"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Open ",(0,i.jsx)(s.code,{children:"custom_message_py/package.xml"})," and add the following lines within the ",(0,i.jsx)(s.code,{children:"<build_depends>"})," and ",(0,i.jsx)(s.code,{children:"<exec_depends>"})," tags (you might already have ",(0,i.jsx)(s.code,{children:"rclpy"})," and ",(0,i.jsx)(s.code,{children:"std_msgs"}),"):"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-xml",children:"  <build_depend>rosidl_default_generators</build_depend>\n  <exec_depend>rosidl_default_runtime</exec_depend>\n  <member_of_group>rosidl_interface_packages</member_of_group>\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Your ",(0,i.jsx)(s.code,{children:"package.xml"})," should look similar to this (dependencies might vary slightly):"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>custom_message_py</name>\n  <version>0.0.0</version>\n  <description>TODO: Package description</description>\n  <maintainer email="user@example.com">Your Name</maintainer>\n  <license>TODO: License declaration</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n\n  <build_depend>rosidl_default_generators</build_depend>\n  <exec_depend>rosidl_default_runtime</exec_depend>\n  <member_of_group>rosidl_interface_packages</member_of_group>\n\n  <test_depend>ament_copyright</test_depend>\n  <test_depend>ament_flake8</test_depend>\n  <test_depend>ament_pep257</test_depend>\n  <test_depend>python3-pytest</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,i.jsxs)(s.h3,{id:"step-4-update-setuppy",children:["Step 4: Update ",(0,i.jsx)(s.code,{children:"setup.py"})]}),"\n",(0,i.jsxs)(s.p,{children:["You need to configure ",(0,i.jsx)(s.code,{children:"setup.py"})," to ensure your custom messages are generated and installed correctly."]}),"\n",(0,i.jsxs)(s.p,{children:["Open ",(0,i.jsx)(s.code,{children:"custom_message_py/setup.py"})," and modify it as follows:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"from setuptools import find_packages, setup\nimport os\nfrom glob import glob\n\npackage_name = 'custom_message_py'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=find_packages(exclude=['test']),\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        # Add these lines to install message files\n        (os.path.join('share', package_name, 'msg'), glob('msg/*.msg')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='user@example.com',\n    description='TODO: Package description',\n    license='TODO: License declaration',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'publisher = custom_message_py.publisher_member_function:main',\n            'subscriber = custom_message_py.subscriber_member_function:main',\n        ],\n    },\n)\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Explanation of Changes:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"import os"})," and ",(0,i.jsx)(s.code,{children:"from glob import glob"}),": Needed for path manipulation and finding ",(0,i.jsx)(s.code,{children:".msg"})," files."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"data_files"}),": The critical change here is ",(0,i.jsx)(s.code,{children:"(os.path.join('share', package_name, 'msg'), glob('msg/*.msg'))"}),", which tells ",(0,i.jsx)(s.code,{children:"ament"})," to install your custom ",(0,i.jsx)(s.code,{children:".msg"})," files so they can be found by other packages."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"entry_points"}),": Defines the executable scripts for your publisher and subscriber nodes."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"step-5-implement-the-publisher-node",children:"Step 5: Implement the Publisher Node"}),"\n",(0,i.jsxs)(s.p,{children:["Create a new Python file ",(0,i.jsx)(s.code,{children:"custom_message_py/custom_message_py/publisher_member_function.py"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nfrom custom_message_py.msg import MyCustomMsg # Import your custom message\n\nclass CustomPublisher(Node):\n    def __init__(self):\n        super().__init__('custom_publisher')\n        # Create a publisher for your custom message type\n        self.publisher_ = self.create_publisher(MyCustomMsg, 'custom_topic', 10)\n        timer_period = 1.0  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.count = 0\n\n    def timer_callback(self):\n        msg = MyCustomMsg() # Create an instance of your custom message\n        msg.header_info = f'Message from Publisher {self.count}'\n        msg.id = self.count\n        msg.temperature = 25.5 + (self.count * 0.1) # Example data\n        msg.is_valid = True if self.count % 2 == 0 else False\n\n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.header_info}\", ID: {msg.id}, Temp: {msg.temperature}\xb0C, Valid: {msg.is_valid}')\n        self.count += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    custom_publisher = CustomPublisher()\n    rclpy.spin(custom_publisher)\n    custom_publisher.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(s.h3,{id:"step-6-implement-the-subscriber-node",children:"Step 6: Implement the Subscriber Node"}),"\n",(0,i.jsxs)(s.p,{children:["Create a new Python file ",(0,i.jsx)(s.code,{children:"custom_message_py/custom_message_py/subscriber_member_function.py"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nfrom custom_message_py.msg import MyCustomMsg # Import your custom message\n\nclass CustomSubscriber(Node):\n    def __init__(self):\n        super().__init__('custom_subscriber')\n        # Create a subscriber for your custom message type\n        self.subscription = self.create_subscription(\n            MyCustomMsg, # Subscribe to your custom message type\n            'custom_topic',\n            self.listener_callback,\n            10)\n        self.subscription  # prevent unused variable warning\n\n    def listener_callback(self, msg: MyCustomMsg):\n        self.get_logger().info(f'Received: \"{msg.header_info}\", ID: {msg.id}, Temp: {msg.temperature}\xb0C, Valid: {msg.is_valid}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    custom_subscriber = CustomSubscriber()\n    rclpy.spin(custom_subscriber)\n    custom_subscriber.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(s.h3,{id:"step-7-build-your-package",children:"Step 7: Build Your Package"}),"\n",(0,i.jsxs)(s.p,{children:["Now, build your workspace from the root of your ",(0,i.jsx)(s.code,{children:"ros2_ws"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select custom_message_py\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This command will build only your ",(0,i.jsx)(s.code,{children:"custom_message_py"})," package, including generating the necessary Python interfaces for ",(0,i.jsx)(s.code,{children:"MyCustomMsg"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"step-8-run-the-nodes",children:"Step 8: Run the Nodes"}),"\n",(0,i.jsx)(s.p,{children:"Source your workspace and then run the publisher and subscriber in separate terminals:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Source your workspace:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"source install/setup.bash\n"})}),"\n",(0,i.jsx)(s.p,{children:"(You need to do this in every new terminal you open for ROS 2)."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Run the Publisher:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ros2 run custom_message_py publisher\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Run the Subscriber:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ros2 run custom_message_py subscriber\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"You should see the publisher node sending custom messages, and the subscriber node receiving and printing the structured data. This demonstrates successful communication using a custom message type in ROS 2."})]})}function p(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>a});var r=n(6540);const i={},t=r.createContext(i);function o(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);